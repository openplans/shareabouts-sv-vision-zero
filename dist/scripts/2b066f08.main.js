var Shareabouts=Shareabouts||{};!function(a,b){function c(c,d){b(".shareabouts-streetview-container").addClass("active"),b(".shareabouts-location-map-container").removeClass("active");var e=new a.StreetView({el:".shareabouts-streetview",map:{center:[c,d],maxDistance:"100m"},placeStyles:[{condition:'"{{location_type}}" == "doublepark"',icon:{url:"styles/images/markers/marker-doublepark.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-doublepark.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "jaywalking"',icon:{url:"styles/images/markers/marker-jaywalking.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-jaywalking.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "longcross"',icon:{url:"styles/images/markers/marker-longcross.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-longcross.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "longwait"',icon:{url:"styles/images/markers/marker-longwait.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-longwait.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "notime"',icon:{url:"styles/images/markers/marker-notime.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-notime.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "redlight"',icon:{url:"styles/images/markers/marker-redlight.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-redlight.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "speeding"',icon:{url:"styles/images/markers/marker-speeding.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-speeding.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "visibility"',icon:{url:"styles/images/markers/marker-visibility.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-visibility.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "yield"',icon:{url:"styles/images/markers/marker-yield.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-yield.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "bike"',icon:{url:"styles/images/markers/marker-bike.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-bike.png",anchor:new google.maps.Point(40,79)}},{condition:'"{{location_type}}" == "other"',icon:{url:"styles/images/markers/marker-unknown.png",scaledSize:new google.maps.Size(48,57),anchor:new google.maps.Point(24,48)},focusIcon:{url:"styles/images/markers/marker-unknown.png",anchor:new google.maps.Point(40,79)}},{condition:"true",newIcon:{url:"styles/images/marker-plus-shadowed.png",anchor:new google.maps.Point(40,79)}}],datasetUrl:"http://data.shareabouts.org/api/v2/nycdot/datasets/vz-dev/places",addButtonLabel:"Share an Issue",maxDistance:25,templates:{"place-summary":Handlebars.compile(b("#place-summary").html()),"place-detail":Handlebars.compile(b("#place-detail").html()),"place-form":Handlebars.compile(b("#place-form").html()),"place-survey":Handlebars.compile(b("#place-survey").html()),"place-survey-item":Handlebars.compile(b("#place-survey-item").html())}});b(e).on("showplacesurvey",function(b,c){new Spinner(a.smallSpinnerOptions).spin(c.$(".form-spinner")[0])})}function d(){var a=new google.maps.Map(b(".shareabouts-location-map").get(0),{center:new google.maps.LatLng(40.7210690835,-73.9981985092),zoom:14,minZoom:11,maxZoom:19,streetViewControl:!1,panControl:!1,mapTypeControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}}),d=new google.maps.ImageMapType({getTileUrl:function(a,b){function c(a,b){return Math.floor(Math.random()*(b-a+1))+a}var d=["a","b","c","d"];return["http://",d[c(0,3)],".tiles.mapbox.com/v3/openplans.i7opnbif/",b,"/",a.x,"/",a.y,".png"].join("")},tileSize:new google.maps.Size(256,256)});a.overlayMapTypes.push(d),wax.tilejson("http://a.tiles.mapbox.com/v3/openplans.vision-zero-places.json",function(b){a.overlayMapTypes.push(new wax.g.connector(b)),wax.g.interaction().map(a).tilejson(b).on({on:function(b){a.setOptions({draggableCursor:"pointer"}),"click"===b.e.type&&c(b.data.YCOORD,b.data.XCOORD)},off:function(){a.setOptions({draggableCursor:"url(http://maps.google.com/mapfiles/openhand.cur), move"})}})}),google.maps.event.addListener(a,"zoom_changed",function(){b(".zoom-in-msg").toggleClass("is-hidden",a.getZoom()>=15)})}a.smallSpinnerOptions={lines:13,length:0,width:3,radius:10,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},a.Config={placeTypes:{notime:{label:"Not Enough Time to Cross"},doublepark:{label:"Double Parking"},longwait:{label:"Long Wait to Cross"},redlight:{label:"Red Light Running"},jaywalking:{label:"Jaywalking"},visibility:{label:"Poor Visibility"},speeding:{label:"Speeding"},longcross:{label:"Long Distance to Cross"},"yield":{label:"Failure to Yield"},bike:{label:"Cyclist Behavior"},other:{label:"Other"}}},b(function(){d(),b(document).on("click",".place-type-selector",function(a){var c=b(a.currentTarget),d=b(a.target).closest("li"),e=c.hasClass("is-open"),f=d.attr("data-value"),g=b('[name="location_type"]');e?(g.val(f),c.find("li").removeClass("active"),d.addClass("active"),c.removeClass("is-open"),"other"===f?(b(".other-type-instructions").removeClass("is-hidden"),b("#place-description").prop("required",!0),b('label[for="place-description"] small').addClass("is-hidden")):(b(".other-type-instructions").addClass("is-hidden"),b("#place-description").prop("required",!1),b('label[for="place-description"] small').removeClass("is-hidden")),b('label[for="place-location_type"]').get(0).scrollIntoView()):c.addClass("is-open")}),b(document).on("click",".close-streetview-button",function(){b(".shareabouts-streetview-container").removeClass("active"),b(".shareabouts-streetview").empty(),b(".shareabouts-location-map-container").addClass("active")})})}(Shareabouts,jQuery);